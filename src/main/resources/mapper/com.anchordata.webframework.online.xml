<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.anchordata.webframework.online">

	<resultMap id="online" type="OnlineVO">
		<result property ="online_id"				column="ONLINE_ID"	/>
		<result property ="url"						column="URL"	/>
		<result property ="title"					column="TITLE"	/>
		<result property ="writer"					column="WRITER"	/>
		<result property ="job_gb"					column="JOB_GB"	/>
		<result property ="video_tp_cd"				column="VIDEO_TP_CD"	/>
		<result property ="upload_file_id"			column="UPLOAD_FILE_ID"	/>
		<result property ="upload_file_name"		column="UPLOAD_FILE_NAME"	/>
		<result property ="upload_file_image"		column="UPLOAD_FILE_IMAGE"	/>
		<result property ="file_name"				column="FILE_NAME"	/>
		<result property ="reg_date"				column="REG_DATE"	/>
		
		<result property ="total_count"				column="TOTAL_COUNT"	/>
	</resultMap>
	
	
	<insert id="insertInfo" useGeneratedKeys="true" keyProperty="online_id" parameterType="OnlineVO">
		INSERT INTO LECTURE_ONLINE ( 
			URL
			, TITLE
			, WRITER
			, JOB_GB
			, VIDEO_TP_CD
			, UPLOAD_FILE_ID
			, FILE_NAME
		) 
		VALUES (
			#{url}
			, #{title}
			, #{writer}
			, #{job_gb}
			, #{video_tp_cd}
			, #{upload_file_id}
			, #{file_name}
		);
	</insert>
	
	
	<update id="updateInfo" parameterType="OnlineVO">
		UPDATE LECTURE_ONLINE  SET   
			TITLE = #{title}
			,	WRITER = #{writer}
			,	REG_DATE = NOW()
			<if test="url != null and url != '' ">
			,	URL = #{url}
			</if>
			<if test="file_name != null and file_name != '' ">
			,	FILE_NAME = #{file_name}
			</if>
			<if test="upload_file_id != null and upload_file_id != '' ">
			,	UPLOAD_FILE_ID = #{upload_file_id}
			</if>
		WHERE 
			ONLINE_ID = #{online_id}
	</update>
	
	
	<delete id="deleteInfo" parameterType="OnlineVO">
		DELETE FROM LECTURE_ONLINE 			
		WHERE ONLINE_ID = #{online_id}
	</delete>	
	
	
	<select id="selectSearchList" parameterType="DataMap"  resultMap="online">
		<include refid="common.pagingPre"/>
		SELECT
			ONLINE_ID
			,   URL
			,	TITLE
			,	WRITER
			,   VIDEO_TP_CD
			,	DATE_FORMAT(REG_DATE,'%Y-%m-%d') AS REG_DATE
			,	UPLOAD_FILE_ID
			,	(SELECT NAME FROM 
					<if test='job_gb.equals("D000004")'>
					SUN_UPLOAD_FILE 
					</if>
					<if test='job_gb.equals("D000003")'>
					ESS_UPLOAD_FILE 
					</if>
				WHERE FILE_ID = A.UPLOAD_FILE_ID) AS UPLOAD_FILE_NAME
			,	(SELECT BINARY_CONTENT FROM 
					<if test='job_gb.equals("D000004")'>	
					SUN_UPLOAD_FILE 
					</if>
					<if test='job_gb.equals("D000003")'>
					ESS_UPLOAD_FILE 
					</if> 
				WHERE FIlE_ID = A.UPLOAD_FILE_ID) AS UPLOAD_FILE_IMAGE
			, FILE_NAME
		FROM
			LECTURE_ONLINE A
		WHERE
			<if test='job_gb != null and job_gb != "" '>
				JOB_GB = #{job_gb}
			</if>
			<choose>
				<when test='title != null and title != ""'>
					AND TITLE LIKE CONCAT('%',#{title},'%')
				</when>
				<when test='writer != null and writer != ""'>
					AND WRITER LIKE CONCAT('%',#{writer},'%')
				</when>		
				<when test='reg_date != null and reg_date != ""'>
					AND DATE_FORMAT(REG_DATE,'%Y-%m-%d') = #{reg_date}
				</when>		
			</choose>
		<include refid="common.pagingPost"/>
	</select>
	
	
	
	<select id="selectAllList" resultMap="online">
		SELECT
			ONLINE_ID
			,   URL
			,	TITLE
			,	WRITER
			,   VIDEO_TP_CD
			,	DATE_FORMAT(REG_DATE,'%Y-%m-%d') AS REG_DATE
		FROM
			LECTURE_ONLINE
	</select>
	
	<select id="selectSearchAllList" parameterType="DataMap"  resultMap="online">
		SELECT
			ONLINE_ID
			,   URL
			,	TITLE
			,	WRITER
			,   VIDEO_TP_CD
			,	DATE_FORMAT(REG_DATE,'%Y-%m-%d') AS REG_DATE
			,	(SELECT NAME FROM 
					<if test='job_gb.equals("D000004")'>
					SUN_UPLOAD_FILE 
					</if>
					<if test='job_gb.equals("D000003")'>
					ESS_UPLOAD_FILE 
					</if>
				WHERE FILE_ID = A.UPLOAD_FILE_ID) AS UPLOAD_FILE_NAME
			,	(SELECT BINARY_CONTENT FROM 
					<if test='job_gb.equals("D000004")'>	
					SUN_UPLOAD_FILE 
					</if>
					<if test='job_gb.equals("D000003")'>
					ESS_UPLOAD_FILE 
					</if> 
				WHERE FIlE_ID = A.UPLOAD_FILE_ID) AS UPLOAD_FILE_IMAGE
			, FILE_NAME
		FROM
			LECTURE_ONLINE A
		WHERE
			<if test='job_gb != null and job_gb != "" '>
				JOB_GB = #{job_gb}
			</if>
			<choose>
				<when test='title != null and title != ""'>
					AND TITLE LIKE CONCAT('%',#{title},'%')
				</when>
				<when test='writer != null and writer != ""'>
					AND WRITER LIKE CONCAT('%',#{writer},'%')
				</when>		
				<when test='reg_date != null and reg_date != ""'>
					AND DATE_FORMAT(REG_DATE,'%Y-%m-%d') = #{reg_date}
				</when>		
			</choose>
			
	</select>
	
	<select id="selectDetail" parameterType="OnlineVO"  resultMap="online">
		SELECT
			ONLINE_ID
			,	TITLE
			,	WRITER
			,   URL
			,   VIDEO_TP_CD
			,	DATE_FORMAT(REG_DATE,'%Y-%m-%d') AS REG_DATE
			,	UPLOAD_FILE_ID
			,	(SELECT NAME FROM 
					<if test='job_gb.equals("D000004")'>
					SUN_UPLOAD_FILE 
					</if>
					<if test='job_gb.equals("D000003")'>
					ESS_UPLOAD_FILE 
					</if>
				WHERE FILE_ID = A.UPLOAD_FILE_ID) AS UPLOAD_FILE_NAME
			,	(SELECT BINARY_CONTENT FROM 
					<if test='job_gb.equals("D000004")'>	
					SUN_UPLOAD_FILE 
					</if>
					<if test='job_gb.equals("D000003")'>
					ESS_UPLOAD_FILE 
					</if> 
				WHERE FIlE_ID = A.UPLOAD_FILE_ID) AS UPLOAD_FILE_IMAGE
			, FILE_NAME
		FROM
			LECTURE_ONLINE A
		WHERE
			ONLINE_ID = #{online_id}
	</select>
	
</mapper>